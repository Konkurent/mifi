# ADR-001: Микросервисная архитектура

**Статус:** Принято  
**Дата:** 2025  
**Участники:** Команда разработки

## Контекст

Требовалось создать масштабируемую систему управления бронированиями с возможностью:
- Независимого развертывания компонентов
- Горизонтального масштабирования отдельных частей системы
- Изоляции сбоев
- Разделения ответственности между командами

## Решение

Использована микросервисная архитектура с разделением на следующие сервисы:

1. **auth-service** (порт 8084)
   - Управление аутентификацией и авторизацией
   - Генерация и валидация JWT токенов
   - Управление учетными записями пользователей (AccessEntity)
   - Централизованный источник информации о пользователях

2. **booking-service** (порт 8083)
   - Управление бронированиями (BookingEntity)
   - Управление пользователями (UserEntity)
   - Координация процесса бронирования через Saga pattern
   - Компенсация при ошибках

3. **hotel-service** (порт 8085)
   - Управление отелями (Hotel)
   - Управление номерами (Room)
   - Распределение нагрузки по номерам
   - Идемпотентные операции инкремента/декремента счетчика

4. **gateway-service** (порт 8080)
   - Единая точка входа для всех запросов
   - Маршрутизация запросов к соответствующим сервисам
   - Централизованная CORS конфигурация
   - Load balancing через Eureka

5. **discovery-service** (порт 8761)
   - Service Discovery на базе Netflix Eureka
   - Регистрация и обнаружение микросервисов
   - Health check и мониторинг состояния сервисов

## Обоснование

### Преимущества:
- **Независимое масштабирование**: Каждый сервис можно масштабировать отдельно в зависимости от нагрузки
- **Изоляция сбоев**: Сбой одного сервиса не приводит к полной недоступности системы
- **Разделение ответственности**: Каждый сервис имеет четко определенную бизнес-функцию
- **Технологическая гибкость**: Возможность использовать разные технологии для разных сервисов
- **Независимое развертывание**: Изменения в одном сервисе не требуют перезапуска других

### Недостатки:
- **Сложность коммуникации**: Необходимость обеспечения надежной связи между сервисами
- **Распределенные транзакции**: Классические ACID транзакции невозможны (решено через Saga pattern)
- **Управление данными**: Необходимость обеспечения согласованности данных между сервисами
- **Операционная сложность**: Больше компонентов для мониторинга и управления

## Последствия

### Положительные:
- ✅ Система легко масштабируется
- ✅ Возможность независимой разработки сервисов
- ✅ Изоляция сбоев и возможность graceful degradation
- ✅ Упрощенное тестирование отдельных компонентов

### Негативные:
- ⚠️ Необходимость реализации механизмов согласованности данных (Saga)
- ⚠️ Увеличенная сложность отладки распределенной системы
- ⚠️ Необходимость настройки service discovery и gateway
- ⚠️ Более сложное развертывание (требуется оркестрация)

## Альтернативы

### Монолитная архитектура
**Отклонено**, так как:
- Не обеспечивает необходимую масштабируемость
- Сложнее изолировать сбои
- Невозможно независимое развертывание компонентов

### Модульный монолит
**Отклонено**, так как:
- Не решает проблему масштабирования отдельных частей
- Все компоненты связаны одним процессом

## Резюме

Микросервисная архитектура выбрана как оптимальное решение для создания масштабируемой и отказоустойчивой системы бронирований с возможностью независимого развития компонентов.

