# вытягиваем базовый образ, на котором будем собирать наше Java приложение
FROM openjdk:17-jdk-slim AS build
COPY pom.xml mvnw ./
COPY .mvn .mvn
# вытягиваем из центрального репозитория необходимые зависимости для сборки
RUN ./mvnw dependency:resolve
# копируем "исходники" приложения в наш подготовительный image
COPY src src
# собираем приложение
RUN ./mvnw package

# вытягиваем базовый образ, на котором будем разворачивать наше Java приложение
FROM openjdk:17-jdk-slim
# обявляяем внутренний порт, на который будем завязывать внешний
EXPOSE 8080
# объявляем рабочую директорию
WORKDIR demo
# копируем артефакт сборки внурь контейнера
COPY --from=build target/*.jar demo.jar
# объявляем точку входа (команда при старте контейнера)
ENTRYPOINT ["java", "-jar", "demo.jar"]